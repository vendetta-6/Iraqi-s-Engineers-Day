<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>حائط المهندسين العراقيين</title>
  <style>
    body {
      background: #f4f4f4;
      font-family: sans-serif;
      direction: rtl;
    }
    #wall {
      width: 100%;
      height: 100vh;
      position: relative;
      border: 2px dashed #aaa;
      overflow: hidden;
      background-size: cover;
      background-repeat: no-repeat;
    }
    .note {
      position: absolute;
      padding: 10px;
      border: 1px solid #333;
      cursor: move;
      transition: all 0.3s ease-in-out;
    }
    .note:hover {
      transform: scale(1.1) rotate(2deg);
    }
    .applyBtn {
      display: block;
      margin-top: 5px;
    }
    canvas {
      border: 2px solid #333;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h2 style="text-align:center;">حائط المهندسين العراقيين</h2>

  <form id="noteForm">
    <input type="text" id="name" placeholder="اسمك" required />
    <input type="text" id="quote" placeholder="مقولتك" required />
    <input type="file" id="photoUpload" accept="image/*"/>
    <input type="color" id="bgColor" value="#FFD700"/> 
    <input type="color" id="textColor" value="#000000"/>
    <select id="shapeSelect">
      <option value="square">مربع</option>
      <option value="circle">دائرة</option>
    </select>
    <button type="submit">أضف قصاصتك</button>
  </form>

  <input type="file" id="bgUpload" accept="image/*" />
  <input type="text" id="searchBox" placeholder="ابحث عن مقولة..." />
  <button id="themeShuffle">تغيير المظهر</button>

  <canvas id="drawArea"></canvas>
  
  <div id="wall"></div>

  <script>
    const form = document.getElementById('noteForm');
    const wall = document.getElementById('wall');

    // Background Upload
    document.getElementById('bgUpload').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(event) {
          wall.style.backgroundImage = `url(${event.target.result})`;
        };
        reader.readAsDataURL(file);
      }
    });

    // Adding notes
    form.onsubmit = e => {
      e.preventDefault();
      const name = document.getElementById('name').value;
      const quote = document.getElementById('quote').value;
      const bgColor = document.getElementById('bgColor').value;
      const textColor = document.getElementById('textColor').value;
      const shape = document.getElementById('shapeSelect').value;
      const photoFile = document.getElementById('photoUpload').files[0];

      const note = document.createElement('div');
      note.className = 'note';
      note.style.backgroundColor = bgColor;
      note.style.color = textColor;
      note.textContent = name + ': ' + quote;

      if (shape === "circle") {
        note.style.borderRadius = "50%";
        note.style.padding = "20px";
      }

      if (photoFile) {
        const reader = new FileReader();
        reader.onload = function(event) {
          const img = document.createElement('img');
          img.src = event.target.result;
          img.style.width = '100px';
          note.appendChild(img);
        };
        reader.readAsDataURL(photoFile);
      }

      makeDraggable(note);
      wall.appendChild(note);
      form.reset();
    };

    // Making notes draggable
    function makeDraggable(el) {
      el.onmousedown = function(e) {
        e.preventDefault();
        const shiftX = e.clientX - el.getBoundingClientRect().left;
        const shiftY = e.clientY - el.getBoundingClientRect().top;

        function moveAt(pageX, pageY) {
          el.style.left = pageX - shiftX + 'px';
          el.style.top = pageY - shiftY + 'px';
        }

        function onMouseMove(e) {
          moveAt(e.pageX, e.pageY);
        }

        document.addEventListener('mousemove', onMouseMove);
        el.onmouseup = function() {
          document.removeEventListener('mousemove', onMouseMove);
          el.onmouseup = null;
        };
      };

      const applyBtn = document.createElement('button');
      applyBtn.textContent = "ثبت الموقع";
      applyBtn.className = "applyBtn";
      el.appendChild(applyBtn);

      applyBtn.onclick = function() {
        el.style.cursor = "default";
        el.onmousedown = null;
        applyBtn.remove();
      };
    }

    // Like & Comment System
    function addInteractions(note) {
      const likeBtn = document.createElement('button');
      likeBtn.textContent = "❤️ 0";
      likeBtn.setAttribute('data-likes', '0');
      likeBtn.onclick = function() {
        let likes = parseInt(likeBtn.getAttribute('data-likes'), 10);
        likes++;
        likeBtn.textContent = `❤️ ${likes}`;
        likeBtn.setAttribute('data-likes', likes);
      };
      note.appendChild(likeBtn);

      const commentBtn = document.createElement('button');
      commentBtn.textContent = "💬 تعليق";
      commentBtn.onclick = function() {
        const commentBox = document.createElement('textarea');
        commentBox.placeholder = "أضف تعليقًا...";
        note.appendChild(commentBox);
      };
      note.appendChild(commentBtn);
    }

    // Search System
    document.getElementById('searchBox').addEventListener('input', function() {
      const searchTerm = this.value.toLowerCase();
      document.querySelectorAll('.note').forEach(note => {
        note.style.display = note.textContent.toLowerCase().includes(searchTerm) ? 'block' : 'none';
      });
    });

    // Theme Shuffle
    document.getElementById('themeShuffle').addEventListener('click', function() {
      const themes = ["#2E2E2E", "#004E98", "#F7B801", "#FF6363"];
      wall.style.backgroundColor = themes[Math.floor(Math.random() * themes.length)];
    });

    // Drawing Area
    const canvas = document.getElementById('drawArea');
    const ctx = canvas.getContext('2d');
    canvas.width = 500;
    canvas.height = 300;
    ctx.fillStyle = "white";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    canvas.onmousedown = function(e) {
      ctx.beginPath();
      ctx.moveTo(e.offsetX, e.offsetY);
      canvas.onmousemove = function(ev) {
        ctx.lineTo(ev.offsetX, ev.offsetY);
        ctx.stroke();
      };
      document.onmouseup = function() {
        canvas.onmousemove = null;
        document.onmouseup = null;
      };
    };
  </script>
</body>
</html>
